<main class="nxl-container">
    <div class="nxl-content">
      <div class="page-header d-flex justify-content-between align-items-center mb-4">
        <div class="page-header-left">
          <h4 class="fw-bold mb-1">Daftar Chat</h4>
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
              <li class="breadcrumb-item"><a href="/" class="text-decoration-none">Home</a></li>
              <li class="breadcrumb-item active">Chats</li>
            </ol>
          </nav>
        </div>
        <button class="btn btn-primary" id="refresh-btn">
          <i class="bi bi-arrow-clockwise me-1"></i> Refresh
        </button>
      </div>
  
      <div class="main-content">
        <div id="session-list" class="row g-4">
          <!-- Sessions will be loaded here -->
        </div>
      </div>
    </div>
  </main>
  
  <script>
    async function loadSessions() {
      const token = localStorage.getItem('token');
      const container = document.getElementById('session-list');
      container.innerHTML = '<div class="col-12 text-center py-5"><div class="spinner-border text-primary" role="status"></div><p class="mt-3 text-muted">Memuat sesi...</p></div>';
  
      try {
        const response = await fetch('http://localhost:3000/api/whatsapp/sessions', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
  
        const data = await response.json();
        if (!data.success || data.sessions.length === 0) {
          container.innerHTML = `
            <div class="col-12 text-center py-5">
              <i class="bi bi-chat-left-dots fs-1 text-muted mb-3"></i>
              <h5 class="text-muted">Tidak ada sesi ditemukan</h5>
              <p class="text-muted">Tambahkan sesi baru untuk memulai chat</p>
            </div>`;
          return;
        }
  
        container.innerHTML = '';
        data.sessions.forEach(session => {
          const div = document.createElement('div');
          div.className = 'col-md-6 col-lg-4';
          div.innerHTML = `
            <a href="/chats/list?id=${session.session_id}" class="text-decoration-none">
              <div class="card border-0 shadow-sm hover-shadow h-100 transition">
                <div class="card-body p-4">
                  <div class="d-flex justify-content-between mb-3">
                    <h5 class="card-title mb-0 text-truncate">${session.session_id}</h5>
                    <span class="badge ${session.isConnected ? 'bg-success' : 'bg-danger'} rounded-pill">
                      ${session.isConnected ? 'Terhubung' : 'Belum'}
                    </span>
                  </div>
                  <div class="d-flex align-items-center">
                    <i class="bi ${session.isConnected ? 'bi-phone-fill text-success' : 'bi-phone text-muted'} me-2 fs-5"></i>
                    <span class="text-muted">WhatsApp Session</span>
                  </div>
                </div>
              </div>
            </a>
          `;
          container.appendChild(div);
        });
      } catch (err) {
        console.error('Error:', err);
        container.innerHTML = `
          <div class="col-12 text-center py-5">
            <i class="bi bi-exclamation-circle text-danger fs-1 mb-3"></i>
            <h5 class="text-danger">Gagal memuat sesi</h5>
            <p class="text-muted">Silakan coba lagi nanti</p>
          </div>`;
      }
    }
  
    document.addEventListener('DOMContentLoaded', () => {
      loadSessions();
      
      // Add event listener for refresh button
      document.getElementById('refresh-btn').addEventListener('click', loadSessions);
    });
  </script>
  
  <style>
    .transition {
      transition: all 0.3s ease;
    }
    
    .hover-shadow:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
    }
    
    .card {
      border-radius: 12px;
    }
    
    .badge {
      padding: 0.5em 0.8em;
    }
  </style>